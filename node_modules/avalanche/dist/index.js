"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.HDNode = exports.Mnemonic = exports.PubSub = exports.Socket = exports.Buffer = exports.BN = exports.AvalancheCore = exports.DB = exports.BinTools = exports.Avalanche = void 0;
/**
 * @packageDocumentation
 * @module Avalanche
 */
const avalanche_1 = __importDefault(require("./avalanche"));
exports.AvalancheCore = avalanche_1.default;
const api_1 = require("./apis/admin/api");
const api_2 = require("./apis/auth/api");
const api_3 = require("./apis/avm/api");
const api_4 = require("./apis/evm/api");
const api_5 = require("./apis/health/api");
const api_6 = require("./apis/index/api");
const api_7 = require("./apis/info/api");
const api_8 = require("./apis/keystore/api");
const api_9 = require("./apis/metrics/api");
const api_10 = require("./apis/platformvm/api");
const socket_1 = require("./apis/socket/socket");
Object.defineProperty(exports, "Socket", { enumerable: true, get: function () { return socket_1.Socket; } });
const constants_1 = require("./utils/constants");
const helperfunctions_1 = require("./utils/helperfunctions");
const bintools_1 = __importDefault(require("./utils/bintools"));
exports.BinTools = bintools_1.default;
const db_1 = __importDefault(require("./utils/db"));
exports.DB = db_1.default;
const mnemonic_1 = __importDefault(require("./utils/mnemonic"));
exports.Mnemonic = mnemonic_1.default;
const pubsub_1 = __importDefault(require("./utils/pubsub"));
exports.PubSub = pubsub_1.default;
const hdnode_1 = __importDefault(require("./utils/hdnode"));
exports.HDNode = hdnode_1.default;
const bn_js_1 = __importDefault(require("bn.js"));
exports.BN = bn_js_1.default;
const buffer_1 = require("buffer/");
Object.defineProperty(exports, "Buffer", { enumerable: true, get: function () { return buffer_1.Buffer; } });
/**
 * AvalancheJS is middleware for interacting with Avalanche node RPC APIs.
 *
 * Example usage:
 * ```js
 * let avalanche = new Avalanche("127.0.0.1", 9650, "https");
 * ```
 *
 */
class Avalanche extends avalanche_1.default {
    /**
       * Creates a new Avalanche instance. Sets the address and port of the main Avalanche Client.
       *
       * @param ip The hostname to resolve to reach the Avalanche Client RPC APIs
       * @param port The port to resolve to reach the Avalanche Client RPC APIs
       * @param protocol The protocol string to use before a "://" in a request,
       * ex: "http", "https", "git", "ws", etc ...
       * @param networkid Sets the NetworkID of the class. Default [[DefaultNetworkID]]
       * @param XChainID Sets the blockchainID for the AVM. Will try to auto-detect,
       * otherwise default "4R5p2RXDGLqaifZE4hHWH9owe34pfoBULn1DrQTWivjg8o4aH"
       * @param CChainID Sets the blockchainID for the EVM. Will try to auto-detect,
       * otherwise default "2q9e4r6Mu3U68nU1fYjgbR6JvwrRx36CohpAX5UQxse55x1Q5"
       * @param hrp The human-readable part of the bech32 addresses
       * @param skipinit Skips creating the APIs
       */
    constructor(ip, port, protocol = 'http', networkID = constants_1.DefaultNetworkID, XChainID = undefined, CChainID = undefined, hrp = undefined, skipinit = false) {
        super(ip, port, protocol);
        /**
           * Returns a reference to the Admin RPC.
           */
        this.Admin = () => this.apis.admin;
        /**
           * Returns a reference to the Auth RPC.
           */
        this.Auth = () => this.apis.auth;
        /**
         * Returns a reference to the EVMAPI RPC pointed at the C-Chain.
         */
        this.CChain = () => this.apis.cchain;
        /**
           * Returns a reference to the AVM RPC pointed at the X-Chain.
           */
        this.XChain = () => this.apis.xchain;
        /**
           * Returns a reference to the Health RPC for a node.
           */
        this.Health = () => this.apis.health;
        /**
           * Returns a reference to the Index RPC for a node.
           */
        this.Index = () => this.apis.index;
        /**
           * Returns a reference to the Info RPC for a node.
           */
        this.Info = () => this.apis.info;
        /**
           * Returns a reference to the Metrics RPC.
           */
        this.Metrics = () => this.apis.metrics;
        /**
           * Returns a reference to the Keystore RPC for a node. We label it "NodeKeys" to reduce
           * confusion about what it's accessing.
           */
        this.NodeKeys = () => this.apis.keystore;
        /**
           * Returns a reference to the PlatformVM RPC pointed at the P-Chain.
           */
        this.PChain = () => this.apis.pchain;
        let xchainid = XChainID;
        let cchainid = CChainID;
        if (typeof XChainID === 'undefined'
            || !XChainID
            || XChainID.toLowerCase() === 'x') {
            if (networkID.toString() in constants_1.Defaults.network) {
                xchainid = constants_1.Defaults.network[networkID].X.blockchainID;
            }
            else {
                xchainid = constants_1.Defaults.network[12345].X.blockchainID;
            }
        }
        if (typeof CChainID === 'undefined'
            || !CChainID
            || CChainID.toLowerCase() === 'c') {
            if (networkID.toString() in constants_1.Defaults.network) {
                cchainid = constants_1.Defaults.network[networkID].C.blockchainID;
            }
            else {
                cchainid = constants_1.Defaults.network[12345].C.blockchainID;
            }
        }
        if (typeof networkID === 'number' && networkID >= 0) {
            this.networkID = networkID;
        }
        else if (typeof networkID === "undefined") {
            networkID = constants_1.DefaultNetworkID;
        }
        if (typeof hrp !== "undefined") {
            this.hrp = hrp;
        }
        else {
            this.hrp = helperfunctions_1.getPreferredHRP(this.networkID);
        }
        if (!skipinit) {
            this.addAPI('admin', api_1.AdminAPI);
            this.addAPI('auth', api_2.AuthAPI);
            this.addAPI('xchain', api_3.AVMAPI, '/ext/bc/X', xchainid);
            this.addAPI('cchain', api_4.EVMAPI, '/ext/bc/C/avax', cchainid);
            this.addAPI('health', api_5.HealthAPI);
            this.addAPI('info', api_7.InfoAPI);
            this.addAPI('index', api_6.IndexAPI);
            this.addAPI('keystore', api_8.KeystoreAPI);
            this.addAPI('metrics', api_9.MetricsAPI);
            this.addAPI('pchain', api_10.PlatformVMAPI);
        }
    }
}
exports.default = Avalanche;
exports.Avalanche = Avalanche;
exports.utils = __importStar(require("./utils"));
exports.common = __importStar(require("./common"));
exports.admin = __importStar(require("./apis/admin"));
exports.auth = __importStar(require("./apis/auth"));
exports.avm = __importStar(require("./apis/avm"));
exports.evm = __importStar(require("./apis/evm"));
exports.health = __importStar(require("./apis/health"));
exports.info = __importStar(require("./apis/info"));
exports.index = __importStar(require("./apis/index"));
exports.keystore = __importStar(require("./apis/keystore"));
exports.metrics = __importStar(require("./apis/metrics"));
exports.platformvm = __importStar(require("./apis/platformvm"));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7R0FHRztBQUNILDREQUF3QztBQThKL0Isd0JBOUpGLG1CQUFhLENBOEpFO0FBN0p0QiwwQ0FBNEM7QUFDNUMseUNBQTBDO0FBQzFDLHdDQUF3QztBQUN4Qyx3Q0FBd0M7QUFDeEMsMkNBQThDO0FBQzlDLDBDQUE0QztBQUM1Qyx5Q0FBMEM7QUFDMUMsNkNBQWtEO0FBQ2xELDRDQUFnRDtBQUNoRCxnREFBc0Q7QUFDdEQsaURBQThDO0FBc0pyQyx1RkF0SkEsZUFBTSxPQXNKQTtBQXJKZixpREFBK0Q7QUFDL0QsNkRBQTBEO0FBQzFELGdFQUF3QztBQThJL0IsbUJBOUlGLGtCQUFRLENBOElFO0FBN0lqQixvREFBNEI7QUE4SW5CLGFBOUlGLFlBQUUsQ0E4SUU7QUE3SVgsZ0VBQXVDO0FBbUo5QixtQkFuSkYsa0JBQVEsQ0FtSkU7QUFsSmpCLDREQUFtQztBQWlKMUIsaUJBakpGLGdCQUFNLENBaUpFO0FBaEpmLDREQUFtQztBQWtKMUIsaUJBbEpGLGdCQUFNLENBa0pFO0FBakpmLGtEQUF1QjtBQTRJZCxhQTVJRixlQUFFLENBNElFO0FBM0lYLG9DQUFpQztBQTRJeEIsdUZBNUlBLGVBQU0sT0E0SUE7QUExSWY7Ozs7Ozs7O0dBUUc7QUFDSCxNQUFxQixTQUFVLFNBQVEsbUJBQWE7SUFvRGxEOzs7Ozs7Ozs7Ozs7OztTQWNLO0lBQ0wsWUFDRSxFQUFTLEVBQ1QsSUFBVyxFQUNYLFdBQWtCLE1BQU0sRUFDeEIsWUFBbUIsNEJBQWdCLEVBQ25DLFdBQWtCLFNBQVMsRUFDM0IsV0FBa0IsU0FBUyxFQUMzQixNQUFhLFNBQVMsRUFDdEIsV0FBbUIsS0FBSztRQUN4QixLQUFLLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztRQTNFNUI7O2FB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QixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxhQUFPLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxZQUFNLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ3JELElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFlBQU0sRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMxRCxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxlQUFTLENBQUMsQ0FBQztZQUNqQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxhQUFPLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxjQUFRLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxpQkFBVyxDQUFDLENBQUM7WUFDckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsZ0JBQVUsQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLG9CQUFhLENBQUMsQ0FBQztTQUN0QztJQUNILENBQUM7Q0FDRjtBQTFIRCw0QkEwSEM7QUFFUSw4QkFBUztBQVdsQixpREFBaUM7QUFDakMsbURBQW1DO0FBQ25DLHNEQUFzQztBQUN0QyxvREFBb0M7QUFDcEMsa0RBQWtDO0FBQ2xDLGtEQUFrQztBQUNsQyx3REFBd0M7QUFDeEMsb0RBQW9DO0FBQ3BDLHNEQUFzQztBQUN0Qyw0REFBNEM7QUFDNUMsMERBQTBDO0FBQzFDLGdFQUFnRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXG4gKiBAbW9kdWxlIEF2YWxhbmNoZVxuICovXG5pbXBvcnQgQXZhbGFuY2hlQ29yZSBmcm9tICcuL2F2YWxhbmNoZSc7XG5pbXBvcnQgeyBBZG1pbkFQSSB9IGZyb20gJy4vYXBpcy9hZG1pbi9hcGknO1xuaW1wb3J0IHsgQXV0aEFQSSB9IGZyb20gJy4vYXBpcy9hdXRoL2FwaSc7XG5pbXBvcnQgeyBBVk1BUEkgfSBmcm9tICcuL2FwaXMvYXZtL2FwaSc7XG5pbXBvcnQgeyBFVk1BUEkgfSBmcm9tICcuL2FwaXMvZXZtL2FwaSc7XG5pbXBvcnQgeyBIZWFsdGhBUEkgfSBmcm9tICcuL2FwaXMvaGVhbHRoL2FwaSc7XG5pbXBvcnQgeyBJbmRleEFQSSB9IGZyb20gJy4vYXBpcy9pbmRleC9hcGknO1xuaW1wb3J0IHsgSW5mb0FQSSB9IGZyb20gJy4vYXBpcy9pbmZvL2FwaSc7XG5pbXBvcnQgeyBLZXlzdG9yZUFQSSB9IGZyb20gJy4vYXBpcy9rZXlzdG9yZS9hcGknO1xuaW1wb3J0IHsgTWV0cmljc0FQSSB9IGZyb20gJy4vYXBpcy9tZXRyaWNzL2FwaSc7XG5pbXBvcnQgeyBQbGF0Zm9ybVZNQVBJIH0gZnJvbSAnLi9hcGlzL3BsYXRmb3Jtdm0vYXBpJztcbmltcG9ydCB7IFNvY2tldCB9IGZyb20gJy4vYXBpcy9zb2NrZXQvc29ja2V0JztcbmltcG9ydCB7IERlZmF1bHROZXR3b3JrSUQsIERlZmF1bHRzIH0gZnJvbSAnLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0UHJlZmVycmVkSFJQIH0gZnJvbSAnLi91dGlscy9oZWxwZXJmdW5jdGlvbnMnO1xuaW1wb3J0IEJpblRvb2xzIGZyb20gJy4vdXRpbHMvYmludG9vbHMnO1xuaW1wb3J0IERCIGZyb20gJy4vdXRpbHMvZGInO1xuaW1wb3J0IE1uZW1vbmljIGZyb20gJy4vdXRpbHMvbW5lbW9uaWMnXG5pbXBvcnQgUHViU3ViIGZyb20gJy4vdXRpbHMvcHVic3ViJ1xuaW1wb3J0IEhETm9kZSBmcm9tIFwiLi91dGlscy9oZG5vZGVcIlxuaW1wb3J0IEJOIGZyb20gXCJibi5qc1wiO1xuaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSAnYnVmZmVyLyc7XG5cbi8qKlxuICogQXZhbGFuY2hlSlMgaXMgbWlkZGxld2FyZSBmb3IgaW50ZXJhY3Rpbmcgd2l0aCBBdmFsYW5jaGUgbm9kZSBSUEMgQVBJcy5cbiAqXG4gKiBFeGFtcGxlIHVzYWdlOlxuICogYGBganNcbiAqIGxldCBhdmFsYW5jaGUgPSBuZXcgQXZhbGFuY2hlKFwiMTI3LjAuMC4xXCIsIDk2NTAsIFwiaHR0cHNcIik7XG4gKiBgYGBcbiAqXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF2YWxhbmNoZSBleHRlbmRzIEF2YWxhbmNoZUNvcmUge1xuICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBBZG1pbiBSUEMuXG4gICAgICovXG4gIEFkbWluID0gKCkgPT4gdGhpcy5hcGlzLmFkbWluIGFzIEFkbWluQVBJO1xuXG4gIC8qKlxuICAgICAqIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIEF1dGggUlBDLlxuICAgICAqL1xuICBBdXRoID0gKCkgPT4gdGhpcy5hcGlzLmF1dGggYXMgQXV0aEFQSTtcblxuICAvKipcbiAgICogUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgRVZNQVBJIFJQQyBwb2ludGVkIGF0IHRoZSBDLUNoYWluLlxuICAgKi9cbiAgQ0NoYWluID0gKCkgPT4gdGhpcy5hcGlzLmNjaGFpbiBhcyBFVk1BUEk7XG5cbiAgLyoqXG4gICAgICogUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgQVZNIFJQQyBwb2ludGVkIGF0IHRoZSBYLUNoYWluLlxuICAgICAqL1xuICBYQ2hhaW4gPSAoKSA9PiB0aGlzLmFwaXMueGNoYWluIGFzIEFWTUFQSTtcblxuICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBIZWFsdGggUlBDIGZvciBhIG5vZGUuXG4gICAgICovXG4gIEhlYWx0aCA9ICgpID0+IHRoaXMuYXBpcy5oZWFsdGggYXMgSGVhbHRoQVBJO1xuXG4gIC8qKlxuICAgICAqIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIEluZGV4IFJQQyBmb3IgYSBub2RlLlxuICAgICAqL1xuICBJbmRleCA9ICgpID0+IHRoaXMuYXBpcy5pbmRleCBhcyBJbmRleEFQSTtcblxuICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBJbmZvIFJQQyBmb3IgYSBub2RlLlxuICAgICAqL1xuICBJbmZvID0gKCkgPT4gdGhpcy5hcGlzLmluZm8gYXMgSW5mb0FQSTtcblxuICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBNZXRyaWNzIFJQQy5cbiAgICAgKi9cbiAgTWV0cmljcyA9ICgpID0+IHRoaXMuYXBpcy5tZXRyaWNzIGFzIE1ldHJpY3NBUEk7XG5cbiAgLyoqXG4gICAgICogUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgS2V5c3RvcmUgUlBDIGZvciBhIG5vZGUuIFdlIGxhYmVsIGl0IFwiTm9kZUtleXNcIiB0byByZWR1Y2VcbiAgICAgKiBjb25mdXNpb24gYWJvdXQgd2hhdCBpdCdzIGFjY2Vzc2luZy5cbiAgICAgKi9cbiAgTm9kZUtleXMgPSAoKSA9PiB0aGlzLmFwaXMua2V5c3RvcmUgYXMgS2V5c3RvcmVBUEk7XG5cbiAgLyoqXG4gICAgICogUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgUGxhdGZvcm1WTSBSUEMgcG9pbnRlZCBhdCB0aGUgUC1DaGFpbi5cbiAgICAgKi9cbiAgUENoYWluID0gKCkgPT4gdGhpcy5hcGlzLnBjaGFpbiBhcyBQbGF0Zm9ybVZNQVBJO1xuXG4gIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgQXZhbGFuY2hlIGluc3RhbmNlLiBTZXRzIHRoZSBhZGRyZXNzIGFuZCBwb3J0IG9mIHRoZSBtYWluIEF2YWxhbmNoZSBDbGllbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaXAgVGhlIGhvc3RuYW1lIHRvIHJlc29sdmUgdG8gcmVhY2ggdGhlIEF2YWxhbmNoZSBDbGllbnQgUlBDIEFQSXNcbiAgICAgKiBAcGFyYW0gcG9ydCBUaGUgcG9ydCB0byByZXNvbHZlIHRvIHJlYWNoIHRoZSBBdmFsYW5jaGUgQ2xpZW50IFJQQyBBUElzXG4gICAgICogQHBhcmFtIHByb3RvY29sIFRoZSBwcm90b2NvbCBzdHJpbmcgdG8gdXNlIGJlZm9yZSBhIFwiOi8vXCIgaW4gYSByZXF1ZXN0LFxuICAgICAqIGV4OiBcImh0dHBcIiwgXCJodHRwc1wiLCBcImdpdFwiLCBcIndzXCIsIGV0YyAuLi5cbiAgICAgKiBAcGFyYW0gbmV0d29ya2lkIFNldHMgdGhlIE5ldHdvcmtJRCBvZiB0aGUgY2xhc3MuIERlZmF1bHQgW1tEZWZhdWx0TmV0d29ya0lEXV1cbiAgICAgKiBAcGFyYW0gWENoYWluSUQgU2V0cyB0aGUgYmxvY2tjaGFpbklEIGZvciB0aGUgQVZNLiBXaWxsIHRyeSB0byBhdXRvLWRldGVjdCxcbiAgICAgKiBvdGhlcndpc2UgZGVmYXVsdCBcIjRSNXAyUlhER0xxYWlmWkU0aEhXSDlvd2UzNHBmb0JVTG4xRHJRVFdpdmpnOG80YUhcIlxuICAgICAqIEBwYXJhbSBDQ2hhaW5JRCBTZXRzIHRoZSBibG9ja2NoYWluSUQgZm9yIHRoZSBFVk0uIFdpbGwgdHJ5IHRvIGF1dG8tZGV0ZWN0LFxuICAgICAqIG90aGVyd2lzZSBkZWZhdWx0IFwiMnE5ZTRyNk11M1U2OG5VMWZZamdiUjZKdndyUngzNkNvaHBBWDVVUXhzZTU1eDFRNVwiXG4gICAgICogQHBhcmFtIGhycCBUaGUgaHVtYW4tcmVhZGFibGUgcGFydCBvZiB0aGUgYmVjaDMyIGFkZHJlc3Nlc1xuICAgICAqIEBwYXJhbSBza2lwaW5pdCBTa2lwcyBjcmVhdGluZyB0aGUgQVBJc1xuICAgICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBpcDpzdHJpbmcsXG4gICAgcG9ydDpudW1iZXIsXG4gICAgcHJvdG9jb2w6c3RyaW5nID0gJ2h0dHAnLFxuICAgIG5ldHdvcmtJRDpudW1iZXIgPSBEZWZhdWx0TmV0d29ya0lELFxuICAgIFhDaGFpbklEOnN0cmluZyA9IHVuZGVmaW5lZCxcbiAgICBDQ2hhaW5JRDpzdHJpbmcgPSB1bmRlZmluZWQsXG4gICAgaHJwOnN0cmluZyA9IHVuZGVmaW5lZCxcbiAgICBza2lwaW5pdDpib29sZWFuID0gZmFsc2UpIHtcbiAgICBzdXBlcihpcCwgcG9ydCwgcHJvdG9jb2wpO1xuICAgIGxldCB4Y2hhaW5pZCA9IFhDaGFpbklEO1xuICAgIGxldCBjY2hhaW5pZCA9IENDaGFpbklEO1xuXG4gICAgaWYgKHR5cGVvZiBYQ2hhaW5JRCA9PT0gJ3VuZGVmaW5lZCdcbiAgICB8fCAhWENoYWluSURcbiAgICB8fCBYQ2hhaW5JRC50b0xvd2VyQ2FzZSgpID09PSAneCcpIHtcbiAgICAgIGlmIChuZXR3b3JrSUQudG9TdHJpbmcoKSBpbiBEZWZhdWx0cy5uZXR3b3JrKSB7XG4gICAgICAgIHhjaGFpbmlkID0gRGVmYXVsdHMubmV0d29ya1tuZXR3b3JrSURdLlguYmxvY2tjaGFpbklEO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgeGNoYWluaWQgPSBEZWZhdWx0cy5uZXR3b3JrWzEyMzQ1XS5YLmJsb2NrY2hhaW5JRDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBDQ2hhaW5JRCA9PT0gJ3VuZGVmaW5lZCdcbiAgICB8fCAhQ0NoYWluSURcbiAgICB8fCBDQ2hhaW5JRC50b0xvd2VyQ2FzZSgpID09PSAnYycpIHtcbiAgICAgIGlmIChuZXR3b3JrSUQudG9TdHJpbmcoKSBpbiBEZWZhdWx0cy5uZXR3b3JrKSB7XG4gICAgICAgIGNjaGFpbmlkID0gRGVmYXVsdHMubmV0d29ya1tuZXR3b3JrSURdLkMuYmxvY2tjaGFpbklEO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2NoYWluaWQgPSBEZWZhdWx0cy5uZXR3b3JrWzEyMzQ1XS5DLmJsb2NrY2hhaW5JRDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBuZXR3b3JrSUQgPT09ICdudW1iZXInICYmIG5ldHdvcmtJRCA+PSAwKSB7XG4gICAgICB0aGlzLm5ldHdvcmtJRCA9IG5ldHdvcmtJRDtcbiAgICB9IGVsc2UgaWYodHlwZW9mIG5ldHdvcmtJRCA9PT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICBuZXR3b3JrSUQgPSBEZWZhdWx0TmV0d29ya0lEO1xuICAgIH1cbiAgICBpZih0eXBlb2YgaHJwICE9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgIHRoaXMuaHJwID0gaHJwO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmhycCA9IGdldFByZWZlcnJlZEhSUCh0aGlzLm5ldHdvcmtJRCk7XG4gICAgfVxuICAgIFxuICAgIGlmICghc2tpcGluaXQpIHtcbiAgICAgIHRoaXMuYWRkQVBJKCdhZG1pbicsIEFkbWluQVBJKTtcbiAgICAgIHRoaXMuYWRkQVBJKCdhdXRoJywgQXV0aEFQSSk7XG4gICAgICB0aGlzLmFkZEFQSSgneGNoYWluJywgQVZNQVBJLCAnL2V4dC9iYy9YJywgeGNoYWluaWQpO1xuICAgICAgdGhpcy5hZGRBUEkoJ2NjaGFpbicsIEVWTUFQSSwgJy9leHQvYmMvQy9hdmF4JywgY2NoYWluaWQpO1xuICAgICAgdGhpcy5hZGRBUEkoJ2hlYWx0aCcsIEhlYWx0aEFQSSk7XG4gICAgICB0aGlzLmFkZEFQSSgnaW5mbycsIEluZm9BUEkpO1xuICAgICAgdGhpcy5hZGRBUEkoJ2luZGV4JywgSW5kZXhBUEkpO1xuICAgICAgdGhpcy5hZGRBUEkoJ2tleXN0b3JlJywgS2V5c3RvcmVBUEkpO1xuICAgICAgdGhpcy5hZGRBUEkoJ21ldHJpY3MnLCBNZXRyaWNzQVBJKTtcbiAgICAgIHRoaXMuYWRkQVBJKCdwY2hhaW4nLCBQbGF0Zm9ybVZNQVBJKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHsgQXZhbGFuY2hlIH07XG5leHBvcnQgeyBCaW5Ub29scyB9O1xuZXhwb3J0IHsgREIgfTtcbmV4cG9ydCB7IEF2YWxhbmNoZUNvcmUgfTtcbmV4cG9ydCB7IEJOIH07XG5leHBvcnQgeyBCdWZmZXIgfTtcbmV4cG9ydCB7IFNvY2tldCB9O1xuZXhwb3J0IHsgUHViU3ViIH07XG5leHBvcnQgeyBNbmVtb25pYyB9XG5leHBvcnQgeyBIRE5vZGUgfVxuXG5leHBvcnQgKiBhcyB1dGlscyBmcm9tICcuL3V0aWxzJztcbmV4cG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbic7XG5leHBvcnQgKiBhcyBhZG1pbiBmcm9tICcuL2FwaXMvYWRtaW4nO1xuZXhwb3J0ICogYXMgYXV0aCBmcm9tICcuL2FwaXMvYXV0aCc7XG5leHBvcnQgKiBhcyBhdm0gZnJvbSAnLi9hcGlzL2F2bSc7XG5leHBvcnQgKiBhcyBldm0gZnJvbSAnLi9hcGlzL2V2bSc7XG5leHBvcnQgKiBhcyBoZWFsdGggZnJvbSAnLi9hcGlzL2hlYWx0aCc7XG5leHBvcnQgKiBhcyBpbmZvIGZyb20gJy4vYXBpcy9pbmZvJztcbmV4cG9ydCAqIGFzIGluZGV4IGZyb20gJy4vYXBpcy9pbmRleCc7XG5leHBvcnQgKiBhcyBrZXlzdG9yZSBmcm9tICcuL2FwaXMva2V5c3RvcmUnO1xuZXhwb3J0ICogYXMgbWV0cmljcyBmcm9tICcuL2FwaXMvbWV0cmljcyc7XG5leHBvcnQgKiBhcyBwbGF0Zm9ybXZtIGZyb20gJy4vYXBpcy9wbGF0Zm9ybXZtJztcbiJdfQ==