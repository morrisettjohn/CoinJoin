"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jest_mock_axios_1 = __importDefault(require("jest-mock-axios"));
const src_1 = require("src");
describe('Index', () => {
    const ip = '127.0.0.1';
    const port = 9650;
    const protocol = 'https';
    const avalanche = new src_1.Avalanche(ip, port, protocol, 12345);
    let index;
    const id = '6fXf5hncR8LXvwtM8iezFQBpK5cubV6y1dWgpJCcNyzGB1EzY';
    const bytes = '111115HRzXVDSeonLBcv6QdJkQFjPzPEobMWy7PyGuoheggsMCx73MVXZo2hJMEXXvR5gFFasTRJH36aVkLiWHtTTFcghyFTqjaHnBhdXTRiLaYcro3jpseqLAFVn3ngnAB47nebQiBBKmg3nFWKzQUDxMuE6uDGXgnGouDSaEKZxfKreoLHYNUxH56rgi5c8gKFYSDi8AWBgy26siwAWj6V8EgFnPVgm9pmKCfXio6BP7Bua4vrupoX8jRGqdrdkN12dqGAibJ78Rf44SSUXhEvJtPxAzjEGfiTyAm5BWFqPdheKN72HyrBBtwC6y7wG6suHngZ1PMBh93Ubkbt8jjjGoEgs5NjpasJpE8YA9ZMLTPeNZ6ELFxV99zA46wvkjAwYHGzegBXvzGU5pGPbg28iW3iKhLoYAnReysY4x3fBhjPBsags37Z9P3SqioVifVX4wwzxYqbV72u1AWZ4JNmsnhVDP196Gu99QTzmySGTVGP5ABNdZrngTRfmGTFCRbt9CHsgNbhgetkxbsEG7tySi3gFxMzGuJ2Npk2gnSr68LgtYdSHf48Ns';
    const timestamp = '2021-04-02T15:34:00.262979-07:00';
    const idx = '0';
    beforeAll(() => {
        index = avalanche.Index();
    });
    afterEach(() => {
        jest_mock_axios_1.default.reset();
    });
    test('getLastAccepted', () => __awaiter(void 0, void 0, void 0, function* () {
        const encoding = 'cb58';
        const baseurl = "/ext/index/X/tx";
        const respobj = {
            id,
            bytes,
            timestamp,
            encoding,
            idx
        };
        const result = index.getLastAccepted(encoding, baseurl);
        const payload = {
            result: respobj,
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(JSON.stringify(response)).toBe(JSON.stringify(respobj));
    }));
    test('getContainerByIndex', () => __awaiter(void 0, void 0, void 0, function* () {
        const encoding = 'cb58';
        const baseurl = "/ext/index/X/tx";
        const respobj = {
            id,
            bytes,
            timestamp,
            encoding,
            idx
        };
        const result = index.getContainerByIndex(idx, encoding, baseurl);
        const payload = {
            result: respobj,
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(JSON.stringify(response)).toBe(JSON.stringify(respobj));
    }));
    test('getContainerByID', () => __awaiter(void 0, void 0, void 0, function* () {
        const encoding = 'cb58';
        const baseurl = "/ext/index/X/tx";
        const respobj = {
            id,
            bytes,
            timestamp,
            encoding,
            idx
        };
        const result = index.getContainerByIndex(id, encoding, baseurl);
        const payload = {
            result: respobj,
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(JSON.stringify(response)).toBe(JSON.stringify(respobj));
    }));
    test('getContainerRange', () => __awaiter(void 0, void 0, void 0, function* () {
        const startIndex = 0;
        const numToFetch = 100;
        const encoding = "hex";
        const baseurl = "/ext/index/X/tx";
        const respobj = {
            id,
            bytes,
            timestamp,
            encoding,
            idx
        };
        const result = index.getContainerRange(startIndex, numToFetch, encoding, baseurl);
        const payload = {
            result: respobj,
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(JSON.stringify(response)).toBe(JSON.stringify(respobj));
    }));
    test('getIndex', () => __awaiter(void 0, void 0, void 0, function* () {
        const encoding = "hex";
        const baseurl = "/ext/index/X/tx";
        const result = index.getIndex(id, encoding, baseurl);
        const payload = {
            result: {
                index: "0"
            },
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(response).toBe('0');
    }));
    test('isAccepted', () => __awaiter(void 0, void 0, void 0, function* () {
        const encoding = "hex";
        const baseurl = "/ext/index/X/tx";
        const result = index.isAccepted(id, encoding, baseurl);
        const payload = {
            result: true
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(response).toBe(true);
    }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90ZXN0cy9hcGlzL2luZGV4L2FwaS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0VBQXdDO0FBQ3hDLDZCQUFnQztBQUloQyxRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtJQUNyQixNQUFNLEVBQUUsR0FBVyxXQUFXLENBQUM7SUFDL0IsTUFBTSxJQUFJLEdBQVcsSUFBSSxDQUFDO0lBQzFCLE1BQU0sUUFBUSxHQUFXLE9BQU8sQ0FBQztJQUVqQyxNQUFNLFNBQVMsR0FBYyxJQUFJLGVBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN0RSxJQUFJLEtBQWUsQ0FBQztJQUVwQixNQUFNLEVBQUUsR0FBVyxtREFBbUQsQ0FBQztJQUN2RSxNQUFNLEtBQUssR0FBWSw0akJBQTRqQixDQUFDO0lBQ3BsQixNQUFNLFNBQVMsR0FBVyxrQ0FBa0MsQ0FBQztJQUM3RCxNQUFNLEdBQUcsR0FBVyxHQUFHLENBQUM7SUFFeEIsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLEtBQUssR0FBRyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDNUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IseUJBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNwQixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxpQkFBaUIsRUFBRSxHQUFTLEVBQUU7UUFDakMsTUFBTSxRQUFRLEdBQVcsTUFBTSxDQUFDO1FBQ2hDLE1BQU0sT0FBTyxHQUFXLGlCQUFpQixDQUFBO1FBQ3pDLE1BQU0sT0FBTyxHQUFHO1lBQ2QsRUFBRTtZQUNGLEtBQUs7WUFDTCxTQUFTO1lBQ1QsUUFBUTtZQUNSLEdBQUc7U0FDSixDQUFDO1FBQ0YsTUFBTSxNQUFNLEdBQW1CLEtB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QUksRUFBRSxPQUFPO1NBQ2QsQ0FBQztRQUVGLHlCQUFTLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sUUFBUSxHQUFVLE1BQU0sTUFBTSxDQUFDO1FBRXJDLE1BQU0sQ0FBQyx5QkFBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFN0IsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxZQUFZLEVBQUUsR0FBUyxFQUFFO1FBQzVCLE1BQU0sUUFBUSxHQUFXLEtBQUssQ0FBQztRQUMvQixNQUFNLE9BQU8sR0FBVyxpQkFBaUIsQ0FBQTtRQUN6QyxNQUFNLE1BQU0sR0FBb0IsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRXhFLE1BQU0sT0FBTyxHQUFVO1lBQ3JCLE1BQU0sRUFBRSxJQUFJO1NBQ2IsQ0FBQztRQUNGLE1BQU0sV0FBVyxHQUFHO1lBQ2xCLElBQUksRUFBRSxPQUFPO1NBQ2QsQ0FBQztRQUVGLHlCQUFTLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sUUFBUSxHQUFXLE1BQU0sTUFBTSxDQUFDO1FBRXRDLE1BQU0sQ0FBQyx5QkFBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFOUIsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vY2tBeGlvcyBmcm9tICdqZXN0LW1vY2stYXhpb3MnO1xuaW1wb3J0IHsgQXZhbGFuY2hlIH0gZnJvbSAnc3JjJztcbmltcG9ydCB7IEluZGV4QVBJIH0gZnJvbSAnc3JjL2FwaXMvaW5kZXgvYXBpJztcbmltcG9ydCB7IEdldExhc3RBY2NlcHRlZFJlc3BvbnNlIH0gZnJvbSAnc3JjL2NvbW1vbi9pbnRlcmZhY2VzJztcblxuZGVzY3JpYmUoJ0luZGV4JywgKCkgPT4ge1xuICBjb25zdCBpcDogc3RyaW5nID0gJzEyNy4wLjAuMSc7XG4gIGNvbnN0IHBvcnQ6IG51bWJlciA9IDk2NTA7XG4gIGNvbnN0IHByb3RvY29sOiBzdHJpbmcgPSAnaHR0cHMnO1xuXG4gIGNvbnN0IGF2YWxhbmNoZTogQXZhbGFuY2hlID0gbmV3IEF2YWxhbmNoZShpcCwgcG9ydCwgcHJvdG9jb2wsIDEyMzQ1KTtcbiAgbGV0IGluZGV4OiBJbmRleEFQSTtcblxuICBjb25zdCBpZDogc3RyaW5nID0gJzZmWGY1aG5jUjhMWHZ3dE04aWV6RlFCcEs1Y3ViVjZ5MWRXZ3BKQ2NOeXpHQjFFelknO1xuICBjb25zdCBieXRlczogc3RyaW5nID0gICcxMTExMTVIUnpYVkRTZW9uTEJjdjZRZEprUUZqUHpQRW9iTVd5N1B5R3VvaGVnZ3NNQ3g3M01WWFpvMmhKTUVYWHZSNWdGRmFzVFJKSDM2YVZrTGlXSHRUVEZjZ2h5RlRxamFIbkJoZFhUUmlMYVljcm8zanBzZXFMQUZWbjNuZ25BQjQ3bmViUWlCQkttZzNuRldLelFVRHhNdUU2dURHWGduR291RFNhRUtaeGZLcmVvTEhZTlV4SDU2cmdpNWM4Z0tGWVNEaThBV0JneTI2c2l3QVdqNlY4RWdGblBWZ205cG1LQ2ZYaW82QlA3QnVhNHZydXBvWDhqUkdxZHJka04xMmRxR0FpYko3OFJmNDRTU1VYaEV2SnRQeEF6akVHZmlUeUFtNUJXRnFQZGhlS043Mkh5ckJCdHdDNnk3d0c2c3VIbmdaMVBNQmg5M1Via2J0OGpqakdvRWdzNU5qcGFzSnBFOFlBOVpNTFRQZU5aNkVMRnhWOTl6QTQ2d3ZrakF3WUhHemVnQlh2ekdVNXBHUGJnMjhpVzNpS2hMb1lBblJleXNZNHgzZkJoalBCc2FnczM3WjlQM1NxaW9WaWZWWDR3d3p4WXFiVjcydTFBV1o0Sk5tc25oVkRQMTk2R3U5OVFUem15U0dUVkdQNUFCTmRacm5nVFJmbUdURkNSYnQ5Q0hzZ05iaGdldGt4YnNFRzd0eVNpM2dGeE16R3VKMk5wazJnblNyNjhMZ3RZZFNIZjQ4TnMnO1xuICBjb25zdCB0aW1lc3RhbXA6IHN0cmluZyA9ICcyMDIxLTA0LTAyVDE1OjM0OjAwLjI2Mjk3OS0wNzowMCc7XG4gIGNvbnN0IGlkeDogc3RyaW5nID0gJzAnO1xuXG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgaW5kZXggPSBhdmFsYW5jaGUuSW5kZXgoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBtb2NrQXhpb3MucmVzZXQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2V0TGFzdEFjY2VwdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGVuY29kaW5nOiBzdHJpbmcgPSAnY2I1OCc7XG4gICAgY29uc3QgYmFzZXVybDogc3RyaW5nID0gXCIvZXh0L2luZGV4L1gvdHhcIiAgXG4gICAgY29uc3QgcmVzcG9iaiA9IHtcbiAgICAgIGlkLFxuICAgICAgYnl0ZXMsXG4gICAgICB0aW1lc3RhbXAsXG4gICAgICBlbmNvZGluZyxcbiAgICAgIGlkeFxuICAgIH07XG4gICAgY29uc3QgcmVzdWx0OlByb21pc2U8b2JqZWN0PiA9IGluZGV4LmdldExhc3RBY2NlcHRlZChlbmNvZGluZywgYmFzZXVybCk7XG5cbiAgICBjb25zdCBwYXlsb2FkOiBvYmplY3QgPSB7XG4gICAgICByZXN1bHQ6IHJlc3BvYmosXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZU9iaiA9IHtcbiAgICAgIGRhdGE6IHBheWxvYWQsXG4gICAgfTtcblxuICAgIG1vY2tBeGlvcy5tb2NrUmVzcG9uc2UocmVzcG9uc2VPYmopO1xuICAgIGNvbnN0IHJlc3BvbnNlOiBvYmplY3QgPSBhd2FpdCByZXN1bHQ7XG4gICAgZXhwZWN0KG1vY2tBeGlvcy5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSkudG9CZShKU09OLnN0cmluZ2lmeShyZXNwb2JqKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dldENvbnRhaW5lckJ5SW5kZXgnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZW5jb2Rpbmc6IHN0cmluZyA9ICdjYjU4JztcbiAgICBjb25zdCBiYXNldXJsOiBzdHJpbmcgPSBcIi9leHQvaW5kZXgvWC90eFwiICBcbiAgICBjb25zdCByZXNwb2JqID0ge1xuICAgICAgaWQsXG4gICAgICBieXRlcyxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIGVuY29kaW5nLFxuICAgICAgaWR4XG4gICAgfTtcbiAgICBjb25zdCByZXN1bHQ6UHJvbWlzZTxvYmplY3Q+ID0gaW5kZXguZ2V0Q29udGFpbmVyQnlJbmRleChpZHgsIGVuY29kaW5nLCBiYXNldXJsKTtcblxuICAgIGNvbnN0IHBheWxvYWQ6IG9iamVjdCA9IHtcbiAgICAgIHJlc3VsdDogcmVzcG9iaixcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlT2JqID0ge1xuICAgICAgZGF0YTogcGF5bG9hZCxcbiAgICB9O1xuXG4gICAgbW9ja0F4aW9zLm1vY2tSZXNwb25zZShyZXNwb25zZU9iaik7XG4gICAgY29uc3QgcmVzcG9uc2U6IG9iamVjdCA9IGF3YWl0IHJlc3VsdDtcbiAgICBleHBlY3QobW9ja0F4aW9zLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKS50b0JlKEpTT04uc3RyaW5naWZ5KHJlc3BvYmopKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2V0Q29udGFpbmVyQnlJRCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZzogc3RyaW5nID0gJ2NiNTgnO1xuICAgIGNvbnN0IGJhc2V1cmw6IHN0cmluZyA9IFwiL2V4dC9pbmRleC9YL3R4XCIgIFxuICAgIGNvbnN0IHJlc3BvYmogPSB7XG4gICAgICBpZCxcbiAgICAgIGJ5dGVzLFxuICAgICAgdGltZXN0YW1wLFxuICAgICAgZW5jb2RpbmcsXG4gICAgICBpZHhcbiAgICB9O1xuICAgIGNvbnN0IHJlc3VsdDpQcm9taXNlPG9iamVjdD4gPSBpbmRleC5nZXRDb250YWluZXJCeUluZGV4KGlkLCBlbmNvZGluZywgYmFzZXVybCk7XG5cbiAgICBjb25zdCBwYXlsb2FkOiBvYmplY3QgPSB7XG4gICAgICByZXN1bHQ6IHJlc3BvYmosXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZU9iaiA9IHtcbiAgICAgIGRhdGE6IHBheWxvYWQsXG4gICAgfTtcblxuICAgIG1vY2tBeGlvcy5tb2NrUmVzcG9uc2UocmVzcG9uc2VPYmopO1xuICAgIGNvbnN0IHJlc3BvbnNlOiBvYmplY3QgPSBhd2FpdCByZXN1bHQ7XG4gICAgZXhwZWN0KG1vY2tBeGlvcy5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSkudG9CZShKU09OLnN0cmluZ2lmeShyZXNwb2JqKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dldENvbnRhaW5lclJhbmdlJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHN0YXJ0SW5kZXg6IG51bWJlciA9IDA7XG4gICAgY29uc3QgbnVtVG9GZXRjaDogbnVtYmVyID0gMTAwO1xuICAgIGNvbnN0IGVuY29kaW5nOiBzdHJpbmcgPSBcImhleFwiO1xuICAgIGNvbnN0IGJhc2V1cmw6IHN0cmluZyA9IFwiL2V4dC9pbmRleC9YL3R4XCIgIFxuICAgIGNvbnN0IHJlc3BvYmogPSB7XG4gICAgICBpZCxcbiAgICAgIGJ5dGVzLFxuICAgICAgdGltZXN0YW1wLFxuICAgICAgZW5jb2RpbmcsXG4gICAgICBpZHhcbiAgICB9O1xuICAgIGNvbnN0IHJlc3VsdDpQcm9taXNlPG9iamVjdFtdPiA9IGluZGV4LmdldENvbnRhaW5lclJhbmdlKHN0YXJ0SW5kZXgsIG51bVRvRmV0Y2gsIGVuY29kaW5nLCBiYXNldXJsKTtcblxuICAgIGNvbnN0IHBheWxvYWQ6IG9iamVjdCA9IHtcbiAgICAgIHJlc3VsdDogcmVzcG9iaixcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlT2JqID0ge1xuICAgICAgZGF0YTogcGF5bG9hZCxcbiAgICB9O1xuXG4gICAgbW9ja0F4aW9zLm1vY2tSZXNwb25zZShyZXNwb25zZU9iaik7XG4gICAgY29uc3QgcmVzcG9uc2U6IG9iamVjdCA9IGF3YWl0IHJlc3VsdDtcbiAgICBleHBlY3QobW9ja0F4aW9zLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKS50b0JlKEpTT04uc3RyaW5naWZ5KHJlc3BvYmopKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2V0SW5kZXgnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZW5jb2Rpbmc6IHN0cmluZyA9IFwiaGV4XCI7XG4gICAgY29uc3QgYmFzZXVybDogc3RyaW5nID0gXCIvZXh0L2luZGV4L1gvdHhcIiAgXG4gICAgY29uc3QgcmVzdWx0OlByb21pc2U8c3RyaW5nPiA9IGluZGV4LmdldEluZGV4KGlkLCBlbmNvZGluZywgYmFzZXVybCk7XG5cbiAgICBjb25zdCBwYXlsb2FkOm9iamVjdCA9IHtcbiAgICAgIHJlc3VsdDoge1xuICAgICAgICBpbmRleDogXCIwXCJcbiAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZU9iaiA9IHtcbiAgICAgIGRhdGE6IHBheWxvYWQsXG4gICAgfTtcblxuICAgIG1vY2tBeGlvcy5tb2NrUmVzcG9uc2UocmVzcG9uc2VPYmopO1xuICAgIGNvbnN0IHJlc3BvbnNlOnN0cmluZyA9IGF3YWl0IHJlc3VsdDtcblxuICAgIGV4cGVjdChtb2NrQXhpb3MucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChyZXNwb25zZSkudG9CZSgnMCcpO1xuXG4gIH0pO1xuXG4gIHRlc3QoJ2lzQWNjZXB0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZW5jb2Rpbmc6IHN0cmluZyA9IFwiaGV4XCI7XG4gICAgY29uc3QgYmFzZXVybDogc3RyaW5nID0gXCIvZXh0L2luZGV4L1gvdHhcIiAgXG4gICAgY29uc3QgcmVzdWx0OlByb21pc2U8Ym9vbGVhbj4gPSBpbmRleC5pc0FjY2VwdGVkKGlkLCBlbmNvZGluZywgYmFzZXVybCk7XG5cbiAgICBjb25zdCBwYXlsb2FkOm9iamVjdCA9IHtcbiAgICAgIHJlc3VsdDogdHJ1ZVxuICAgIH07XG4gICAgY29uc3QgcmVzcG9uc2VPYmogPSB7XG4gICAgICBkYXRhOiBwYXlsb2FkLFxuICAgIH07XG5cbiAgICBtb2NrQXhpb3MubW9ja1Jlc3BvbnNlKHJlc3BvbnNlT2JqKTtcbiAgICBjb25zdCByZXNwb25zZTpib29sZWFuID0gYXdhaXQgcmVzdWx0O1xuXG4gICAgZXhwZWN0KG1vY2tBeGlvcy5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0JlKHRydWUpO1xuXG4gIH0pO1xufSk7XG4iXX0=