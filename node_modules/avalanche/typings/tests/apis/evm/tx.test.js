"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const evm_1 = require("src/apis/evm");
const constants_1 = require("src/utils/constants");
const constants_2 = require("../../../src/utils/constants");
const evm_2 = require("src/apis/evm");
const bn_js_1 = __importDefault(require("bn.js"));
const src_1 = require("src");
const networkID = 12345;
const cHexAddress1 = "0x8db97C7cEcE249c2b98bDC0226Cc4C2A57BF52FC";
const bintools = src_1.BinTools.getInstance();
const cHexAddress2 = "0xecC3B2968B277b837a81A7181e0b94EB1Ca54EdE";
const antAssetID = "F4MyJcUvq3Rxbqgd4Zs8sUpvwLHApyrp4yxJXe2bAV86Vvp38";
const avaxAssetID = constants_1.Defaults.network[networkID].X.avaxAssetID;
const txID = "QVb7DtKjcwVYLFWHgnGSdzQtQSc29KeRBYFNCBnbFu6dFqX7z";
const blockchainID = constants_1.Defaults.network[networkID].C.blockchainID;
const sourcechainID = constants_1.Defaults.network[networkID].X.blockchainID;
let evmOutputs;
let importedIns;
const fee = constants_1.Defaults.network[networkID].C.txFee;
beforeEach(() => {
    evmOutputs = [];
    importedIns = [];
});
describe('EVM Transactions', () => {
    describe('ImportTx', () => {
        test("Multiple AVAX EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAVAX);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with the same address and AVAX assetID is invalid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX, avaxAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX, avaxAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - ImportTx: duplicate (address, assetId) pair found in outputs: (0x8db97c7cece249c2b98bdc0226cc4c2a57bf52fc, 2fombhL7aGPwj3KH4bfrmJwW6PVnMobf9Y2fn9GwxiAAJyFDbe)");
        });
        test("Multiple AVAX EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAVAX);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with different addresses valid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX.div(new bn_js_1.default(3)), avaxAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress2, constants_2.ONEAVAX.div(new bn_js_1.default(3)), avaxAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
        test("Multiple ANT EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(507));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with the same address and ANT assetID is invalid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX, antAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX, antAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - ImportTx: duplicate (address, assetId) pair found in outputs: (0x8db97c7cece249c2b98bdc0226cc4c2a57bf52fc, F4MyJcUvq3Rxbqgd4Zs8sUpvwLHApyrp4yxJXe2bAV86Vvp38)");
        });
        test("Multiple ANT EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(fee);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX, antAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress2, constants_2.ONEAVAX, antAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
        test("Single ANT EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(0));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            // If the output is a non-avax assetID then don't subtract a fee
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX, antAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - 1000000 AVAX required for fee and only 0 AVAX provided");
        });
        test("Single ANT EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAVAX);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX, antAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
        test("Single AVAX EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(507));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, new bn_js_1.default(0), avaxAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - 1000000 AVAX required for fee and only 507 AVAX provided");
        });
        test("Single AVAX EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAVAX);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(avaxAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAVAX.sub(constants_1.MILLIAVAX), avaxAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHgudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3RzL2FwaXMvZXZtL3R4LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxzQ0FJc0I7QUFDdEIsbURBQTBEO0FBQzFELDREQUF1RDtBQUN2RCxzQ0FBeUM7QUFDekMsa0RBQXVCO0FBQ3ZCLDZCQUdhO0FBQ2IsTUFBTSxTQUFTLEdBQVcsS0FBSyxDQUFDO0FBQ2hDLE1BQU0sWUFBWSxHQUFXLDRDQUE0QyxDQUFDO0FBQzFFLE1BQU0sUUFBUSxHQUFhLGNBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtBQUNqRCxNQUFNLFlBQVksR0FBVyw0Q0FBNEMsQ0FBQztBQUMxRSxNQUFNLFVBQVUsR0FBVyxtREFBbUQsQ0FBQztBQUMvRSxNQUFNLFdBQVcsR0FBVyxvQkFBUSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDO0FBQ3RFLE1BQU0sSUFBSSxHQUFXLG1EQUFtRCxDQUFDO0FBQ3pFLE1BQU0sWUFBWSxHQUFXLG9CQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDeEUsTUFBTSxhQUFhLEdBQVcsb0JBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztBQUN6RSxJQUFJLFVBQXVCLENBQUM7QUFDNUIsSUFBSSxXQUFnQyxDQUFDO0FBQ3JDLE1BQU0sR0FBRyxHQUFPLG9CQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7QUFFcEQsVUFBVSxDQUFDLEdBQVMsRUFBRTtJQUNwQixVQUFVLEdBQUcsRUFBRSxDQUFDO0lBQ2hCLFdBQVcsR0FBRyxFQUFFLENBQUM7QUFDbkIsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFF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LHVCQUFpQixDQUFDLG1CQUFPLENBQUMsQ0FBQztZQUNoRSxNQUFNLE1BQU0sR0FBc0IsSUFBSSx1QkFBaUIsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZJLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekIsTUFBTSxTQUFTLEdBQWMsSUFBSSxlQUFTLENBQUMsWUFBWSxFQUFFLG1CQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFTLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUM5RixVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzNCLE1BQU0sUUFBUSxHQUFhLElBQUksY0FBUSxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ25KLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxjQUFjLENBQUMsY0FBUSxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXG4gIEltcG9ydFR4LCBcbiAgU0VDUFRyYW5zZmVySW5wdXQsIFxuICBUcmFuc2ZlcmFibGVJbnB1dCBcbn0gZnJvbSAnc3JjL2FwaXMvZXZtJztcbmltcG9ydCB7IERlZmF1bHRzLCBNSUxMSUFWQVggfSBmcm9tICdzcmMvdXRpbHMvY29uc3RhbnRzJztcbmltcG9ydCB7IE9ORUFWQVggfSBmcm9tICcuLi8uLi8uLi9zcmMvdXRpbHMvY29uc3RhbnRzJztcbmltcG9ydCB7IEVWTU91dHB1dCB9IGZyb20gJ3NyYy9hcGlzL2V2bSc7XG5pbXBvcnQgQk4gZnJvbSBcImJuLmpzXCI7XG5pbXBvcnQgeyBcbiAgQmluVG9vbHMsXG4gIEJ1ZmZlciBcbn0gZnJvbSAnc3JjJztcbmNvbnN0IG5ldHdvcmtJRDogbnVtYmVyID0gMTIzNDU7XG5jb25zdCBjSGV4QWRkcmVzczE6IHN0cmluZyA9IFwiMHg4ZGI5N0M3Y0VjRTI0OWMyYjk4YkRDMDIyNkNjNEMyQTU3QkY1MkZDXCI7XG5jb25zdCBiaW50b29sczogQmluVG9vbHMgPSBCaW5Ub29scy5nZXRJbnN0YW5jZSgpXG5jb25zdCBjSGV4QWRkcmVzczI6IHN0cmluZyA9IFwiMHhlY0MzQjI5NjhCMjc3YjgzN2E4MUE3MTgxZTBiOTRFQjFDYTU0RWRFXCI7XG5jb25zdCBhbnRBc3NldElEOiBzdHJpbmcgPSBcIkY0TXlKY1V2cTNSeGJxZ2Q0WnM4c1VwdndMSEFweXJwNHl4SlhlMmJBVjg2VnZwMzhcIjtcbmNvbnN0IGF2YXhBc3NldElEOiBzdHJpbmcgPSBEZWZhdWx0cy5uZXR3b3JrW25ldHdvcmtJRF0uWC5hdmF4QXNzZXRJRDtcbmNvbnN0IHR4SUQ6IHN0cmluZyA9IFwiUVZiN0R0S2pjd1ZZTEZXSGduR1NkelF0UVNjMjlLZVJCWUZOQ0JuYkZ1NmRGcVg3elwiO1xuY29uc3QgYmxvY2tjaGFpbklEOiBzdHJpbmcgPSBEZWZhdWx0cy5uZXR3b3JrW25ldHdvcmtJRF0uQy5ibG9ja2NoYWluSUQ7XG5jb25zdCBzb3VyY2VjaGFpbklEOiBzdHJpbmcgPSBEZWZhdWx0cy5uZXR3b3JrW25ldHdvcmtJRF0uWC5ibG9ja2NoYWluSUQ7XG5sZXQgZXZtT3V0cHV0czogRVZNT3V0cHV0W107XG5sZXQgaW1wb3J0ZWRJbnM6IFRyYW5zZmVyYWJsZUlucHV0W107XG5jb25zdCBmZWU6IEJOID0gRGVmYXVsdHMubmV0d29ya1tuZXR3b3JrSURdLkMudHhGZWU7XG5cbmJlZm9yZUVhY2goKCk6IHZvaWQgPT4ge1xuICBldm1PdXRwdXRzID0gW107XG4gIGltcG9ydGVkSW5zID0gW107XG59KTtcblxuZGVzY3JpYmUoJ0VWTSBUcmFuc2FjdGlvbnMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdJbXBvcnRUeCcsICgpID0+IHtcbiAgICB0ZXN0KFwiTXVsdGlwbGUgQVZBWCBFVk1PdXRwdXQgZmFpbFwiLCAoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBvdXRwdXRpZHg6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKFwiXCIpO1xuICAgICAgY29uc3QgaW5wdXQ6IFNFQ1BUcmFuc2ZlcklucHV0ID0gbmV3IFNFQ1BUcmFuc2ZlcklucHV0KE9ORUFWQVgpO1xuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLCBvdXRwdXRpZHgsIGJpbnRvb2xzLmNiNThEZWNvZGUoYXZheEFzc2V0SUQpLCBpbnB1dCk7XG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbik7XG4gICAgICAvLyBDcmVhdGluZyAyIG91dHB1dHMgd2l0aCB0aGUgc2FtZSBhZGRyZXNzIGFuZCBBVkFYIGFzc2V0SUQgaXMgaW52YWxpZFxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFWQVgsIGF2YXhBc3NldElEKTtcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpO1xuICAgICAgZXZtT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFWQVgsIGF2YXhBc3NldElEKTtcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpO1xuXG4gICAgICBleHBlY3QoKCk6IHZvaWQgPT4ge1xuICAgICAgICBuZXcgSW1wb3J0VHgobmV0d29ya0lELCBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksIGltcG9ydGVkSW5zLCBldm1PdXRwdXRzKTtcbiAgICAgIH0pLnRvVGhyb3coXCJFcnJvciAtIEltcG9ydFR4OiBkdXBsaWNhdGUgKGFkZHJlc3MsIGFzc2V0SWQpIHBhaXIgZm91bmQgaW4gb3V0cHV0czogKDB4OGRiOTdjN2NlY2UyNDljMmI5OGJkYzAyMjZjYzRjMmE1N2JmNTJmYywgMmZvbWJoTDdhR1B3ajNLSDRiZnJtSndXNlBWbk1vYmY5WTJmbjlHd3hpQUFKeUZEYmUpXCIpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcIk11bHRpcGxlIEFWQVggRVZNT3V0cHV0IHN1Y2Nlc3NcIiwgKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKTtcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChPTkVBVkFYKTtcbiAgICAgIGNvbnN0IHhmZXJpbjogVHJhbnNmZXJhYmxlSW5wdXQgPSBuZXcgVHJhbnNmZXJhYmxlSW5wdXQoYmludG9vbHMuY2I1OERlY29kZSh0eElEKSwgb3V0cHV0aWR4LCBiaW50b29scy5jYjU4RGVjb2RlKGF2YXhBc3NldElEKSwgaW5wdXQpO1xuICAgICAgaW1wb3J0ZWRJbnMucHVzaCh4ZmVyaW4pO1xuICAgICAgLy8gQ3JlYXRpbmcgMiBvdXRwdXRzIHdpdGggZGlmZmVyZW50IGFkZHJlc3NlcyB2YWxpZFxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFWQVguZGl2KG5ldyBCTigzKSksIGF2YXhBc3NldElEKTtcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpO1xuICAgICAgZXZtT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczIsIE9ORUFWQVguZGl2KG5ldyBCTigzKSksIGF2YXhBc3NldElEKTtcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpO1xuXG4gICAgICBjb25zdCBpbXBvcnRUeDogSW1wb3J0VHggPSBuZXcgSW1wb3J0VHgobmV0d29ya0lELCBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksIGltcG9ydGVkSW5zLCBldm1PdXRwdXRzKTtcbiAgICAgIGV4cGVjdChpbXBvcnRUeCkudG9CZUluc3RhbmNlT2YoSW1wb3J0VHgpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcIk11bHRpcGxlIEFOVCBFVk1PdXRwdXQgZmFpbFwiLCAoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBvdXRwdXRpZHg6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKFwiXCIpO1xuICAgICAgY29uc3QgaW5wdXQ6IFNFQ1BUcmFuc2ZlcklucHV0ID0gbmV3IFNFQ1BUcmFuc2ZlcklucHV0KG5ldyBCTig1MDcpKTtcbiAgICAgIGNvbnN0IHhmZXJpbjogVHJhbnNmZXJhYmxlSW5wdXQgPSBuZXcgVHJhbnNmZXJhYmxlSW5wdXQoYmludG9vbHMuY2I1OERlY29kZSh0eElEKSwgb3V0cHV0aWR4LCBiaW50b29scy5jYjU4RGVjb2RlKGF2YXhBc3NldElEKSwgaW5wdXQpO1xuICAgICAgaW1wb3J0ZWRJbnMucHVzaCh4ZmVyaW4pO1xuICAgICAgLy8gQ3JlYXRpbmcgMiBvdXRwdXRzIHdpdGggdGhlIHNhbWUgYWRkcmVzcyBhbmQgQU5UIGFzc2V0SUQgaXMgaW52YWxpZFxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFWQVgsIGFudEFzc2V0SUQpO1xuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dCk7XG4gICAgICBldm1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KGNIZXhBZGRyZXNzMSwgT05FQVZBWCwgYW50QXNzZXRJRCk7XG4gICAgICBldm1PdXRwdXRzLnB1c2goZXZtT3V0cHV0KTtcbiAgICAgIGV4cGVjdCgoKTogdm9pZCA9PiB7XG4gICAgICAgIG5ldyBJbXBvcnRUeChuZXR3b3JrSUQsIGJpbnRvb2xzLmNiNThEZWNvZGUoYmxvY2tjaGFpbklEKSwgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKSwgaW1wb3J0ZWRJbnMsIGV2bU91dHB1dHMpO1xuICAgICAgfSkudG9UaHJvdyhcIkVycm9yIC0gSW1wb3J0VHg6IGR1cGxpY2F0ZSAoYWRkcmVzcywgYXNzZXRJZCkgcGFpciBmb3VuZCBpbiBvdXRwdXRzOiAoMHg4ZGI5N2M3Y2VjZTI0OWMyYjk4YmRjMDIyNmNjNGMyYTU3YmY1MmZjLCBGNE15SmNVdnEzUnhicWdkNFpzOHNVcHZ3TEhBcHlycDR5eEpYZTJiQVY4NlZ2cDM4KVwiKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJNdWx0aXBsZSBBTlQgRVZNT3V0cHV0IHN1Y2Nlc3NcIiwgKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKTtcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChmZWUpO1xuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLCBvdXRwdXRpZHgsIGJpbnRvb2xzLmNiNThEZWNvZGUoYXZheEFzc2V0SUQpLCBpbnB1dCk7XG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbik7XG4gICAgICBsZXQgZXZtT3V0cHV0OiBFVk1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KGNIZXhBZGRyZXNzMSwgT05FQVZBWCwgYW50QXNzZXRJRCk7XG4gICAgICBldm1PdXRwdXRzLnB1c2goZXZtT3V0cHV0KTtcbiAgICAgIGV2bU91dHB1dCA9IG5ldyBFVk1PdXRwdXQoY0hleEFkZHJlc3MyLCBPTkVBVkFYLCBhbnRBc3NldElEKTtcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpO1xuXG4gICAgICBjb25zdCBpbXBvcnRUeDogSW1wb3J0VHggPSBuZXcgSW1wb3J0VHgobmV0d29ya0lELCBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksIGltcG9ydGVkSW5zLCBldm1PdXRwdXRzKTtcbiAgICAgIGV4cGVjdChpbXBvcnRUeCkudG9CZUluc3RhbmNlT2YoSW1wb3J0VHgpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcIlNpbmdsZSBBTlQgRVZNT3V0cHV0IGZhaWxcIiwgKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKTtcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChuZXcgQk4oMCkpO1xuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLCBvdXRwdXRpZHgsIGJpbnRvb2xzLmNiNThEZWNvZGUoYXZheEFzc2V0SUQpLCBpbnB1dCk7XG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbik7XG5cbiAgICAgIC8vIElmIHRoZSBvdXRwdXQgaXMgYSBub24tYXZheCBhc3NldElEIHRoZW4gZG9uJ3Qgc3VidHJhY3QgYSBmZWVcbiAgICAgIGNvbnN0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFWQVgsIGFudEFzc2V0SUQpO1xuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dCk7XG4gICAgICBleHBlY3QoKCk6IHZvaWQgPT4ge1xuICAgICAgICBuZXcgSW1wb3J0VHgobmV0d29ya0lELCBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksIGltcG9ydGVkSW5zLCBldm1PdXRwdXRzKTtcbiAgICAgIH0pLnRvVGhyb3coXCJFcnJvciAtIDEwMDAwMDAgQVZBWCByZXF1aXJlZCBmb3IgZmVlIGFuZCBvbmx5IDAgQVZBWCBwcm92aWRlZFwiKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJTaW5nbGUgQU5UIEVWTU91dHB1dCBzdWNjZXNzXCIsICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIik7XG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQoT05FQVZBWCk7XG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksIG91dHB1dGlkeCwgYmludG9vbHMuY2I1OERlY29kZShhdmF4QXNzZXRJRCksIGlucHV0KTtcbiAgICAgIGltcG9ydGVkSW5zLnB1c2goeGZlcmluKTtcbiAgICAgIGNvbnN0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFWQVgsIGFudEFzc2V0SUQpO1xuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dCk7XG4gICAgICBjb25zdCBpbXBvcnRUeDogSW1wb3J0VHggPSBuZXcgSW1wb3J0VHgobmV0d29ya0lELCBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksIGltcG9ydGVkSW5zLCBldm1PdXRwdXRzKTtcbiAgICAgIGV4cGVjdChpbXBvcnRUeCkudG9CZUluc3RhbmNlT2YoSW1wb3J0VHgpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcIlNpbmdsZSBBVkFYIEVWTU91dHB1dCBmYWlsXCIsICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIik7XG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQobmV3IEJOKDUwNykpO1xuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLCBvdXRwdXRpZHgsIGJpbnRvb2xzLmNiNThEZWNvZGUoYXZheEFzc2V0SUQpLCBpbnB1dCk7XG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbik7XG5cbiAgICAgIGNvbnN0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIG5ldyBCTigwKSwgYXZheEFzc2V0SUQpO1xuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dCk7XG4gICAgICBleHBlY3QoKCk6IHZvaWQgPT4ge1xuICAgICAgICBuZXcgSW1wb3J0VHgobmV0d29ya0lELCBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksIGltcG9ydGVkSW5zLCBldm1PdXRwdXRzKTtcbiAgICAgIH0pLnRvVGhyb3coXCJFcnJvciAtIDEwMDAwMDAgQVZBWCByZXF1aXJlZCBmb3IgZmVlIGFuZCBvbmx5IDUwNyBBVkFYIHByb3ZpZGVkXCIpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcIlNpbmdsZSBBVkFYIEVWTU91dHB1dCBzdWNjZXNzXCIsICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIik7XG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQoT05FQVZBWCk7XG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksIG91dHB1dGlkeCwgYmludG9vbHMuY2I1OERlY29kZShhdmF4QXNzZXRJRCksIGlucHV0KTtcbiAgICAgIGltcG9ydGVkSW5zLnB1c2goeGZlcmluKTtcbiAgICAgIGNvbnN0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFWQVguc3ViKE1JTExJQVZBWCksIGF2YXhBc3NldElEKTtcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpO1xuICAgICAgY29uc3QgaW1wb3J0VHg6IEltcG9ydFR4ID0gbmV3IEltcG9ydFR4KG5ldHdvcmtJRCwgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLCBiaW50b29scy5jYjU4RGVjb2RlKHNvdXJjZWNoYWluSUQpLCBpbXBvcnRlZElucywgZXZtT3V0cHV0cyk7XG4gICAgICBleHBlY3QoaW1wb3J0VHgpLnRvQmVJbnN0YW5jZU9mKEltcG9ydFR4KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==